C51 COMPILER V9.54   MAIN                                                                  06/07/2025 16:09:32 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Delay.h"
   3          #include "Key.h"
   4          #include "DS1302.h"
   5          #include "LCD1602.h"
   6          #include "Time.h"
   7          
   8          unsigned char KeyNum, MODE, TimeSetSelect, TimeSetFlashFlag;  //键值 模式值 时间位 时间闪烁标
             -志位
   9          
  10          //闹钟值定义
  11          unsigned char clock[5]; //年月日 时分秒
  12          
  13          //秒表
  14          struct StopTime
  15          {
  16              unsigned char StopHour;     //时
  17              unsigned char StopMinute;   //分
  18              unsigned char StopSecond_0; //秒
  19              unsigned char StopSecond_1; //十分秒
  20              unsigned char StopSecond_2; //百分秒
  21          };
  22          struct StopTime NowTime;            //秒表实时时间
  23          struct StopTime StopTimeArray[10];  //回看值
  24          unsigned char StopTimeNum;          //回看值数
  25          unsigned char StopTimeNumSelect;    //回看值位
  26          unsigned char StopCount;            //秒表中断计数器
  27          unsigned char StopWatchFlag;        //秒表显示标记位
  28          unsigned char StopTimeFlag;         //显示内容(实时/回看)标记位
  29          unsigned char StopWatchAddFlag;     //秒表累计状态位
  30          
  31          /* MODE.JSON
  32          {
  33              "Name":"MODE",
  34              "MODE":{
  35                  "0":"TimeShow",
  36                  "1":"TimeSet",
  37                  "2":"AlarmSet",
  38                  "3":"StopWatch"
  39              }
  40          }
  41          */
  42          
  43          //函数声明部分
  44          void ClearStopNum();
  45          
  46          void TimeShow() //MODE 0 显示时间
  47          {
  48   1          DS1302_ReadTime();
  49   1          LCD_ShowNum(1,1,DS1302_Time[0],2);
  50   1          LCD_ShowNum(1,4,DS1302_Time[1],2);
  51   1          LCD_ShowNum(1,7,DS1302_Time[2],2);
  52   1          LCD_ShowNum(2,1,DS1302_Time[3],2);
  53   1          LCD_ShowNum(2,4,DS1302_Time[4],2);
C51 COMPILER V9.54   MAIN                                                                  06/07/2025 16:09:32 PAGE 2   

  54   1          LCD_ShowNum(2,7,DS1302_Time[5],2);
  55   1      }
  56          
  57          void TimeSet()  //MODE 1 设置时间
  58          {
  59   1          if(KeyNum == 2)
  60   1          {
  61   2              TimeSetSelect++;
  62   2              TimeSetSelect %= 6; //越界清零
  63   2          }
  64   1          if(KeyNum == 3)
  65   1          {
  66   2              DS1302_Time[TimeSetSelect]++;
  67   2      
  68   2              //输入合法性判断
  69   2              if(DS1302_Time[0] > 99) {DS1302_Time[0] = 0;}
  70   2              if(DS1302_Time[1] > 12) {DS1302_Time[1] = 1;}
  71   2      
  72   2              if(DS1302_Time[1] == 1 || DS1302_Time[1] == 3 || DS1302_Time[1] == 5 || DS1302_Time[1] == 7 ||
  73   2                 DS1302_Time[1] == 8 || DS1302_Time[1] == 10 || DS1302_Time[1] == 12)
  74   2              {
  75   3                  if(DS1302_Time[2] > 31) {DS1302_Time[2] = 1;}
  76   3              }
  77   2              else if(DS1302_Time[1] == 4 || DS1302_Time[1] == 6 || DS1302_Time[1] == 9 || DS1302_Time[1] == 11)
  78   2              {
  79   3                  if(DS1302_Time[2] > 30) {DS1302_Time[2] = 1;}
  80   3              }
  81   2              else if(DS1302_Time[1] == 2)
  82   2              {
  83   3                  if(DS1302_Time[0] % 4 == 0)
  84   3                  {
  85   4                      if(DS1302_Time[2] > 29) {DS1302_Time[2] = 1;}
  86   4                  }
  87   3                  else
  88   3                  {
  89   4                      if(DS1302_Time[2] > 28) {DS1302_Time[2] = 1;}
  90   4                  }
  91   3              }
  92   2      
  93   2              if(DS1302_Time[3] > 23) {DS1302_Time[3] = 0;}
  94   2              if(DS1302_Time[4] > 59) {DS1302_Time[4] = 0;}
  95   2              if(DS1302_Time[5] > 59) {DS1302_Time[5] = 0;}
  96   2          }
  97   1          if(KeyNum == 4)
  98   1          {
  99   2              DS1302_Time[TimeSetSelect]--;
 100   2      
 101   2              //输入合法性判断
 102   2              if(DS1302_Time[0] < 0) {DS1302_Time[0] = 99;}
 103   2              if(DS1302_Time[1] < 1) {DS1302_Time[1] = 12;}
 104   2      
 105   2              if(DS1302_Time[1] == 1 || DS1302_Time[1] == 3 || DS1302_Time[1] == 5 || DS1302_Time[1] == 7 ||
 106   2                 DS1302_Time[1] == 8 || DS1302_Time[1] == 10 || DS1302_Time[1] == 12)
 107   2              {
 108   3                  if(DS1302_Time[2] < 1) {DS1302_Time[2] = 31;}
 109   3                  if(DS1302_Time[2] > 31) {DS1302_Time[2] = 1;}
 110   3              }
 111   2              else if(DS1302_Time[1] == 4 || DS1302_Time[1] == 6 || DS1302_Time[1] == 9 || DS1302_Time[1] == 11)
 112   2              {
 113   3                  if(DS1302_Time[2] < 1) {DS1302_Time[2] = 30;}
 114   3                  if(DS1302_Time[2] > 30) {DS1302_Time[2] = 1;}
 115   3              }
C51 COMPILER V9.54   MAIN                                                                  06/07/2025 16:09:32 PAGE 3   

 116   2              else if(DS1302_Time[1] == 2)
 117   2              {
 118   3                  if(DS1302_Time[0] % 4 == 0)
 119   3                  {
 120   4                      if(DS1302_Time[2] < 1) {DS1302_Time[2] = 29;}
 121   4                      if(DS1302_Time[2] > 29) {DS1302_Time[2] = 1;}
 122   4                  }
 123   3                  else
 124   3                  {
 125   4                      if(DS1302_Time[2] < 1) {DS1302_Time[2] = 28;}
 126   4                      if(DS1302_Time[2] > 28) {DS1302_Time[2] = 1;}
 127   4                  }
 128   3              }
 129   2      
 130   2              if(DS1302_Time[3] < 0) {DS1302_Time[3] = 23;}
 131   2              if(DS1302_Time[4] < 0) {DS1302_Time[4] = 59;}
 132   2              if(DS1302_Time[5] < 0) {DS1302_Time[5] = 59;}
 133   2          }
 134   1          
 135   1          //实时显示，未经过DS1302
 136   1          if(TimeSetSelect == 0 && TimeSetFlashFlag == 1) {LCD_ShowString(1,1,"  ");}
 137   1          else {LCD_ShowNum(1,1,DS1302_Time[0],2);}
 138   1          if(TimeSetSelect == 1 && TimeSetFlashFlag == 1) {LCD_ShowString(1,4,"  ");}
 139   1          else {LCD_ShowNum(1,4,DS1302_Time[1],2);}
 140   1          if(TimeSetSelect == 2 && TimeSetFlashFlag == 1) {LCD_ShowString(1,7,"  ");}
 141   1          else {LCD_ShowNum(1,7,DS1302_Time[2],2);}
 142   1          if(TimeSetSelect == 3 && TimeSetFlashFlag == 1) {LCD_ShowString(2,1,"  ");}
 143   1          else {LCD_ShowNum(2,1,DS1302_Time[3],2);}
 144   1          if(TimeSetSelect == 4 && TimeSetFlashFlag == 1) {LCD_ShowString(2,4,"  ");}
 145   1          else {LCD_ShowNum(2,4,DS1302_Time[4],2);}
 146   1          if(TimeSetSelect == 5 && TimeSetFlashFlag == 1) {LCD_ShowString(2,7,"  ");}
 147   1          else {LCD_ShowNum(2,7,DS1302_Time[5],2);}
 148   1          
 149   1          //LCD_ShowNum(2,10,TimeSetSelect,2);
 150   1      }
 151          
 152          void AlarmSet() //MODE 2 设置闹钟
 153          {
 154   1          //设置闹钟时间
 155   1          if(KeyNum == 2)
 156   1          {
 157   2              TimeSetSelect++;
 158   2              TimeSetSelect %= 6;
 159   2          }
 160   1          if(KeyNum == 3)
 161   1          {
 162   2              clock[TimeSetSelect]++;
 163   2      
 164   2              //输入合法性一般判断
 165   2              if(clock[0] > 99) {clock[0] = 0;}
 166   2              if(clock[1] > 12) {clock[1] = 1;}
 167   2      
 168   2              if(clock[1] == 1 || clock[1] == 3 || clock[1] == 5 || clock[1] == 7 ||
 169   2                 clock[1] == 8 || clock[1] == 10 || clock[1] == 12)
 170   2              {
 171   3                  if(clock[2] > 31) {clock[2] = 1;}
 172   3              }
 173   2              else if(clock[1] == 4 || clock[1] == 6 || clock[1] == 9 || clock[1] == 11)
 174   2              {
 175   3                  if(clock[2] > 30) {clock[2] = 1;}
 176   3              }
 177   2              else if(clock[1] == 2)
C51 COMPILER V9.54   MAIN                                                                  06/07/2025 16:09:32 PAGE 4   

 178   2              {
 179   3                  if(clock[0] % 4 == 0)
 180   3                  {
 181   4                      if(clock[2] > 29) {clock[2] = 1;}
 182   4                  }
 183   3                  else
 184   3                  {
 185   4                      if(clock[2] > 28) {clock[2] = 1;}
 186   4                  }
 187   3              }
 188   2      
 189   2              if(clock[3] > 23) {clock[3] = 0;}
 190   2              if(clock[4] > 59) {clock[4] = 0;}
 191   2              if(clock[5] > 59) {clock[5] = 0;}
 192   2      
 193   2              //闹钟时间边界判断
 194   2              if(clock[0] < DS1302_Time[0])
 195   2              {clock[0] = DS1302_Time[0];}
 196   2      
 197   2              if(clock[0] == DS1302_Time[0] && clock[1] < DS1302_Time[1])
 198   2              {clock[1] = DS1302_Time[1];}
 199   2      
 200   2              if(clock[0] == DS1302_Time[0] && clock[1] == DS1302_Time[1] &&
 201   2                 clock[2] < DS1302_Time[2])
 202   2              {clock[2] = DS1302_Time[2];}
 203   2      
 204   2              if(clock[0] == DS1302_Time[0] && clock[1] == DS1302_Time[1] &&
 205   2                 clock[2] == DS1302_Time[2] && clock[3] < DS1302_Time[3])
 206   2              {clock[3] = DS1302_Time[3];}
 207   2      
 208   2              if(clock[0] == DS1302_Time[0] && clock[1] == DS1302_Time[1] &&
 209   2                 clock[2] == DS1302_Time[2] && clock[3] == DS1302_Time[3] &&
 210   2                 clock[4] < DS1302_Time[4])
 211   2              {clock[4] = DS1302_Time[4];}
 212   2      
 213   2              if(clock[0] == DS1302_Time[0] && clock[1] == DS1302_Time[1] &&
 214   2                 clock[2] == DS1302_Time[2] && clock[3] == DS1302_Time[3] &&
 215   2                 clock[4] == DS1302_Time[4] && clock[5] < DS1302_Time[5])
 216   2              {clock[5] = DS1302_Time[5];}
 217   2          }
 218   1          if(KeyNum == 4)
 219   1          {
 220   2              clock[TimeSetSelect]--;       
 221   2      
 222   2              //一般边界判断
 223   2              if(clock[0] < 0) {clock[0] = 99;}
 224   2              if(clock[1] < 1) {clock[1] = 12;}
 225   2      
 226   2              if(clock[1] == 1 || clock[1] == 3 || clock[1] == 5 || clock[1] == 7 ||
 227   2                 clock[1] == 8 || clock[1] == 10 || clock[1] == 12)
 228   2              {
 229   3                  if(clock[2] < 1) {clock[2] = 31;}
 230   3                  if(clock[2] > 31) {clock[2] = 1;}
 231   3              }
 232   2              else if(clock[1] == 4 || clock[1] == 6 || clock[1] == 9 || clock[1] == 11)
 233   2              {
 234   3                  if(clock[2] < 1) {clock[2] = 30;}
 235   3                  if(clock[2] > 30) {clock[2] = 1;}
 236   3              }
 237   2              else if(clock[1] == 2)
 238   2              {
 239   3                  if(clock[0] % 4 == 0)
C51 COMPILER V9.54   MAIN                                                                  06/07/2025 16:09:32 PAGE 5   

 240   3                  {
 241   4                      if(clock[2] < 1) {clock[2] = 29;}
 242   4                      if(clock[2] > 29) {clock[2] = 1;}
 243   4                  }
 244   3                  else
 245   3                  {
 246   4                      if(clock[2] < 1) {clock[2] = 28;}
 247   4                      if(clock[2] > 28) {clock[2] = 1;}
 248   4                  }
 249   3              }
 250   2      
 251   2              if(clock[3] < 0) {clock[3] = 23;}
 252   2              if(clock[4] < 0) {clock[4] = 59;}
 253   2              if(clock[5] < 0) {clock[5] = 59;} 
 254   2          
 255   2      
 256   2              //闹钟时间边界判断
 257   2              if(clock[0] < DS1302_Time[0])
 258   2              {clock[0] = DS1302_Time[0];}
 259   2      
 260   2              if(clock[0] == DS1302_Time[0] && clock[1] < DS1302_Time[1])
 261   2              {clock[1] = DS1302_Time[1];}
 262   2      
 263   2              if(clock[0] == DS1302_Time[0] && clock[1] == DS1302_Time[1] &&
 264   2                 clock[2] < DS1302_Time[2])
 265   2              {clock[2] = DS1302_Time[2];}
 266   2      
 267   2              if(clock[0] == DS1302_Time[0] && clock[1] == DS1302_Time[1] &&
 268   2                 clock[2] == DS1302_Time[2] && clock[3] < DS1302_Time[3])
 269   2              {clock[3] = DS1302_Time[3];}
 270   2      
 271   2              if(clock[0] == DS1302_Time[0] && clock[1] == DS1302_Time[1] &&
 272   2                 clock[2] == DS1302_Time[2] && clock[3] == DS1302_Time[3] &&
 273   2                 clock[4] < DS1302_Time[4])
 274   2              {clock[4] = DS1302_Time[4];}
 275   2      
 276   2              if(clock[0] == DS1302_Time[0] && clock[1] == DS1302_Time[1] &&
 277   2                 clock[2] == DS1302_Time[2] && clock[3] == DS1302_Time[3] &&
 278   2                 clock[4] == DS1302_Time[4] && clock[5] < DS1302_Time[5])
 279   2              {clock[5] = DS1302_Time[5];}
 280   2          }
 281   1      
 282   1          //闹钟时间实时显示，已写入 clock[]
 283   1          if(TimeSetSelect == 0 && TimeSetFlashFlag == 1) {LCD_ShowString(1,1,"  ");}
 284   1          else {LCD_ShowNum(1,1,clock[0],2);}
 285   1          if(TimeSetSelect == 1 && TimeSetFlashFlag == 1) {LCD_ShowString(1,4,"  ");}
 286   1          else {LCD_ShowNum(1,4,clock[1],2);}
 287   1          if(TimeSetSelect == 2 && TimeSetFlashFlag == 1) {LCD_ShowString(1,7,"  ");}
 288   1          else {LCD_ShowNum(1,7,clock[2],2);}
 289   1          if(TimeSetSelect == 3 && TimeSetFlashFlag == 1) {LCD_ShowString(2,1,"  ");}
 290   1          else {LCD_ShowNum(2,1,clock[3],2);}
 291   1          if(TimeSetSelect == 4 && TimeSetFlashFlag == 1) {LCD_ShowString(2,4,"  ");}
 292   1          else {LCD_ShowNum(2,4,clock[4],2);}
 293   1          if(TimeSetSelect == 5 && TimeSetFlashFlag == 1) {LCD_ShowString(2,7,"  ");}
 294   1          else {LCD_ShowNum(2,7,clock[5],2);}
 295   1      }
 296          
 297          void StopWatch()    //MODE 3 秒表
 298          {
 299   1          if(KeyNum == 2) //开始计时(清零并重新计时)
 300   1          {
 301   2              //清空实时时间
C51 COMPILER V9.54   MAIN                                                                  06/07/2025 16:09:32 PAGE 6   

 302   2              NowTime.StopHour = 0;
 303   2              NowTime.StopMinute = 0;
 304   2              NowTime.StopSecond_0 = 0;
 305   2              NowTime.StopSecond_1 = 0;
 306   2              NowTime.StopSecond_2 = 0;
 307   2      
 308   2              //清空 回看记录 回看值 回看选择位
 309   2              ClearStopNum();
 310   2      
 311   2              //初始化状态
 312   2              StopWatchFlag = 1;
 313   2              StopTimeFlag = 0;
 314   2              StopWatchAddFlag = 1;
 315   2          }
 316   1          if(KeyNum == 3) //暂停/运行
 317   1          {
 318   2              StopWatchAddFlag = !StopWatchAddFlag;
 319   2          }
 320   1          if(KeyNum == 4) //运行/添加回看  暂停/回看列表 无记录不回看
 321   1          {
 322   2              if(StopWatchAddFlag)
 323   2              {
 324   3                  if(StopTimeNum < 10)
 325   3                  {
 326   4                      //写入回看值数组
 327   4                      StopTimeArray[StopTimeNum].StopHour = NowTime.StopHour;
 328   4                      StopTimeArray[StopTimeNum].StopMinute = NowTime.StopMinute;
 329   4                      StopTimeArray[StopTimeNum].StopSecond_0 = NowTime.StopSecond_0;
 330   4                      StopTimeArray[StopTimeNum].StopSecond_1 = NowTime.StopSecond_1;
 331   4                      StopTimeArray[StopTimeNum].StopSecond_2 = NowTime.StopSecond_2;
 332   4      
 333   4                      StopTimeNum++;
 334   4                  }
 335   3              }
 336   2              else{
 337   3                  if(StopTimeNum > 0)
 338   3                  {
 339   4                      if(StopTimeFlag == 0)   {StopTimeFlag = 1;}
 340   4                      else if(StopTimeNumSelect == (StopTimeNum - 1))
 341   4                      {
 342   5                          StopTimeNumSelect = 0;
 343   5                          StopTimeFlag = 0;
 344   5                      } 
 345   4                      else    {StopTimeNumSelect++;}
 346   4                  }
 347   3              }
 348   2          }
 349   1          //进入累积前，清空StopCount
 350   1          if(!StopWatchAddFlag)
 351   1          {StopCount = 0;}
 352   1          
 353   1          //秒表累积
 354   1          if(StopWatchAddFlag)
 355   1          {
 356   2              NowTime.StopSecond_2 += StopCount;
 357   2              StopCount = 0;
 358   2      
 359   2              if(NowTime.StopSecond_2 > 9)
 360   2              {
 361   3                  NowTime.StopSecond_2 = (NowTime.StopSecond_2 - 10);
 362   3                  NowTime.StopSecond_1++;
 363   3      
C51 COMPILER V9.54   MAIN                                                                  06/07/2025 16:09:32 PAGE 7   

 364   3                  if(NowTime.StopSecond_1 == 10)
 365   3                  {
 366   4                      NowTime.StopSecond_1 = 0;
 367   4                      NowTime.StopSecond_0++;
 368   4      
 369   4                      if(NowTime.StopSecond_0 == 60)
 370   4                      {
 371   5                          NowTime.StopSecond_0 = 0;
 372   5                          NowTime.StopMinute++;
 373   5      
 374   5                          if(NowTime.StopMinute == 60)
 375   5                          {
 376   6                              NowTime.StopMinute = 0;
 377   6                              NowTime.StopHour++;
 378   6      
 379   6                              if(NowTime.StopHour == 100)
 380   6                              {
 381   7                                  //显示超出边界
 382   7                              }
 383   6                          }
 384   5                      }
 385   4                  }
 386   3              }
 387   2          }
 388   1      
 389   1          //实时显示 时分秒/10/100
 390   1          if(StopWatchFlag)
 391   1          {
 392   2              if(StopTimeFlag)    //回看显示
 393   2              {
 394   3                  LCD_ShowNum(1,1,StopTimeArray[StopTimeNumSelect].StopHour,2);
 395   3                  LCD_ShowNum(1,4,StopTimeArray[StopTimeNumSelect].StopMinute,2);
 396   3                  LCD_ShowNum(2,1,StopTimeArray[StopTimeNumSelect].StopSecond_0,2);
 397   3                  LCD_ShowNum(2,4,StopTimeArray[StopTimeNumSelect].StopSecond_1,1);
 398   3                  LCD_ShowNum(2,5,StopTimeArray[StopTimeNumSelect].StopSecond_2,1);
 399   3      
 400   3                  //显示回看选择位
 401   3                  LCD_ShowString(2,7,"T");
 402   3                  LCD_ShowNum(2,8,StopTimeNumSelect,1);
 403   3              }
 404   2              else    //实时显示
 405   2              {
 406   3                  LCD_ShowNum(1,1,NowTime.StopHour,2);
 407   3                  LCD_ShowNum(1,4,NowTime.StopMinute,2);
 408   3                  LCD_ShowNum(2,1,NowTime.StopSecond_0,2);
 409   3                  LCD_ShowNum(2,4,NowTime.StopSecond_1,1);
 410   3                  LCD_ShowNum(2,5,NowTime.StopSecond_2,1);
 411   3      
 412   3                  //清空回看选择位
 413   3                  LCD_ShowString(2,7,"  ");
 414   3              }
 415   2          }
 416   1      }
 417          
 418          void main()
 419          {
 420   1          //初始化定时器
 421   1          Timer0_Init();
 422   1          Timer1_Init();
 423   1      
 424   1          //初始化时钟模块
 425   1          DS1302_Init();
C51 COMPILER V9.54   MAIN                                                                  06/07/2025 16:09:32 PAGE 8   

 426   1          DS1302_SetTime();
 427   1      
 428   1          //初始化LCD模块
 429   1          LCD_Init();
 430   1          LCD_ShowString(1,1,"  -  -   MODE");
 431   1          LCD_ShowString(2,1,"  :  :   SHOW");
 432   1      
 433   1          while(1)
 434   1          {
 435   2              //change MODE
 436   2              KeyNum = Key();
 437   2              if(KeyNum == 1)
 438   2              {
 439   3                  if(MODE == 0){
 440   4                      MODE = 1;   //进入 TimeSet
 441   4      
 442   4                      //初始化模式显示
 443   4                      LCD_ShowString(1,1,"  -  -   MODE");
 444   4                      LCD_ShowString(2,1,"  :  :   SET");
 445   4      
 446   4                      //初始化时间位
 447   4                      TimeSetSelect = 0;
 448   4                  }
 449   3                  else if(MODE == 1){
 450   4                      MODE = 2;   //进入 AlarmSet
 451   4                      
 452   4                      //将新设置的时间写入DS1302
 453   4                      DS1302_SetTime();
 454   4      
 455   4                      //初始化模式显示
 456   4                      LCD_ShowString(1,1,"  -  -   MODE");
 457   4                      LCD_ShowString(2,1,"  :  :   ALARM");
 458   4      
 459   4                      //初始化时间位
 460   4                      TimeSetSelect = 0;
 461   4      
 462   4                      //将当前新设置的时间写入 clock[]，完成初始化
 463   4                      clock[0] = DS1302_Time[0];
 464   4                      clock[1] = DS1302_Time[1];
 465   4                      clock[2] = DS1302_Time[2];
 466   4                      clock[3] = DS1302_Time[3];
 467   4                      clock[4] = DS1302_Time[4];
 468   4                      clock[5] = DS1302_Time[5];
 469   4                  }
 470   3                  else if (MODE == 2){
 471   4                      MODE = 3;   //进入 StopWatch
 472   4      
 473   4                      //初始化模式显示
 474   4                      LCD_ShowString(1,1,"  :      MODE");
 475   4                      LCD_ShowString(2,1,"  .      S-W");
 476   4                  }
 477   3                  else if (MODE == 3){
 478   4                      MODE = 0;   //进入 TimeShow
 479   4      
 480   4                      //初始化模式显示
 481   4                      LCD_ShowString(1,1,"  -  -   MODE");
 482   4                      LCD_ShowString(2,1,"  :  :   SHOW");
 483   4      
 484   4                      //清零秒表模式
 485   4                      StopWatchFlag = 0;
 486   4                  }
 487   3              }
C51 COMPILER V9.54   MAIN                                                                  06/07/2025 16:09:32 PAGE 9   

 488   2              
 489   2              //MODE 显示
 490   2              switch(MODE)
 491   2              {
 492   3                  case 0: TimeShow(); break;
 493   3                  case 1: TimeSet();  break;
 494   3                  case 2: AlarmSet(); break;
 495   3                  case 3: StopWatch();break;
 496   3              }
 497   2          }
 498   1      }
 499          
 500          //中断部分
 501          void Timer0_ISR(void) interrupt 1 
 502          {
 503   1          static unsigned int T0Count;
 504   1      
 505   1          TH0 = 0xFC;        // 重装初值
 506   1          TL0 = 0x67;
 507   1          // 这里添加1ms定时任务代码
 508   1          T0Count++;
 509   1          if(T0Count >= 500)
 510   1          {
 511   2              T0Count = 0;
 512   2              //中断内容
 513   2              TimeSetFlashFlag = !TimeSetFlashFlag;   //控制时间闪烁
 514   2          }
 515   1      }
 516          
 517          void Timer1_ISR(void) interrupt 3 
 518          {
 519   1          static unsigned int T1Count;
 520   1      
 521   1          TH1 = 0xFC;        // 重装初值
 522   1          TL1 = 0x67;
 523   1          // 这里添加1ms定时任务代码
 524   1          T1Count++;
 525   1          if(T1Count >= 10)
 526   1          {
 527   2              T1Count = 0;
 528   2              StopCount++;
 529   2          }
 530   1      }
 531          
 532          //函数定义部分
 533          void ClearStopNum()
 534          {
 535   1          StopTimeNum = 0;
 536   1          StopTimeNumSelect = 0;
 537   1      
 538   1          for(char i = 0; i < 10; i++)
*** ERROR C141 IN LINE 538 OF main.c: syntax error near 'char'
*** ERROR C202 IN LINE 538 OF main.c: 'i': undefined identifier
*** ERROR C202 IN LINE 538 OF main.c: 'i': undefined identifier
*** ERROR C202 IN LINE 538 OF main.c: 'i': undefined identifier
*** ERROR C141 IN LINE 538 OF main.c: syntax error near ')'
 539   1          {
 540   2              StopTimeArray[i].StopHour = 0;
 541   2              StopTimeArray[i].StopMinute = 0;
*** ERROR C202 IN LINE 541 OF main.c: 'i': undefined identifier
 542   2              StopTimeArray[i].StopSecond_0 = 0;
*** ERROR C202 IN LINE 542 OF main.c: 'i': undefined identifier
C51 COMPILER V9.54   MAIN                                                                  06/07/2025 16:09:32 PAGE 10  

 543   2              StopTimeArray[i].StopSecond_1 = 0;
*** ERROR C202 IN LINE 543 OF main.c: 'i': undefined identifier
 544   2              StopTimeArray[i].StopSecond_2 = 0;
*** ERROR C202 IN LINE 544 OF main.c: 'i': undefined identifier
 545   2          }
 546   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  9 ERROR(S)
